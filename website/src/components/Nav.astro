---
const pathname = Astro.url?.pathname ?? '/';
const isSkills = pathname === '/skills' || pathname.startsWith('/skills/');
const isDefinitions = pathname === '/definitions' || pathname.startsWith('/definitions/');

const manifestLabel = isSkills ? 'skills.json' : isDefinitions ? 'definitions.json' : undefined;
const manifestUrl = isSkills
  ? 'https://www.llmspec.dev/skills/skills.json'
  : isDefinitions
    ? 'https://www.llmspec.dev/definitions/definitions.json'
    : undefined;
---

<nav
  id="site-nav"
  class="fixed inset-x-0 top-0 z-50 h-[60px] md:h-[72px] px-5 md:px-8 bg-transparent transition-colors duration-300 relative"
  aria-label="Primary"
>
  <div class="relative mx-auto flex h-full w-full max-w-6xl items-center justify-between">
    <a
      href="/"
      class="font-serif font-medium tracking-ultra uppercase text-gold text-sm md:text-base leading-none"
    >
      LLMSPEC
    </a>

    <div class="flex items-center gap-6 md:gap-10">
      <a
        href="/skills/"
        class:list={[
          'relative font-sans text-[11px] md:text-xs tracking-widest-plus uppercase text-cream transition-colors duration-300 hover:text-gold',
          'after:absolute after:-bottom-2 after:left-0 after:right-0 after:h-px after:bg-gold after:transition-opacity after:duration-300',
          isSkills ? 'after:opacity-100' : 'after:opacity-0 hover:after:opacity-100',
        ]}
      >
        Skills
      </a>

      <a
        href="/definitions/"
        class:list={[
          'relative font-sans text-[11px] md:text-xs tracking-widest-plus uppercase text-cream transition-colors duration-300 hover:text-gold',
          'after:absolute after:-bottom-2 after:left-0 after:right-0 after:h-px after:bg-gold after:transition-opacity after:duration-300',
          isDefinitions ? 'after:opacity-100' : 'after:opacity-0 hover:after:opacity-100',
        ]}
      >
        Definitions
      </a>

      {manifestLabel && manifestUrl && (
        <div class="hidden md:flex items-center gap-1.5 border border-ash/30 rounded-full px-3 py-1">
          <span class="font-mono text-[10px] md:text-[11px] text-silver/70">{manifestLabel}</span>
          <button
            type="button"
            data-nav-copy
            data-copy-url={manifestUrl}
            class="text-silver/50 hover:text-gold transition-colors"
            aria-label={`Copy ${manifestLabel} URL`}
          >
            <svg data-icon="clipboard" viewBox="0 0 24 24" fill="currentColor" class="h-3.5 w-3.5">
              <path
                d="M16 4h-1.18C14.4 2.84 13.3 2 12 2s-2.4.84-2.82 2H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm-4-1a1 1 0 0 1 1 1h-2a1 1 0 0 1 1-1zm4 17H8V6h1.5v2h5V6H16v14z"
              />
            </svg>
            <svg data-icon="check" viewBox="0 0 24 24" fill="currentColor" class="h-3.5 w-3.5 hidden">
              <path d="M9 16.2l-3.5-3.5L4 14.2l5 5 12-12-1.5-1.5L9 16.2z" />
            </svg>
          </button>
        </div>
      )}

      <a
        href="https://github.com/janfeddersen-wq/llmspecs"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="GitHub repository"
        class="text-silver/60 hover:text-gold transition-colors duration-300"
      >
        <svg viewBox="0 0 16 16" fill="currentColor" class="h-4 w-4 md:h-[18px] md:w-[18px]">
          <path
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"
          />
        </svg>
      </a>
    </div>
  </div>

  <div class="gold-rule pointer-events-none absolute bottom-0 left-0 w-full" />

  <script>
    const nav = document.getElementById('site-nav');
    if (nav) {
      const setScrolled = () => {
        nav.classList.toggle('scrolled', window.scrollY > 50);
      };
      setScrolled();
      window.addEventListener('scroll', setScrolled, { passive: true });
    }

    const copyBtn = document.querySelector('[data-nav-copy]');
    if (copyBtn) {
      const clipIcon = copyBtn.querySelector('[data-icon="clipboard"]');
      const checkIcon = copyBtn.querySelector('[data-icon="check"]');

      const copyUrl = copyBtn.getAttribute('data-copy-url');

      copyBtn.addEventListener('click', async () => {
        if (!copyUrl) return;

        try {
          await navigator.clipboard.writeText(copyUrl);
          if (clipIcon && checkIcon) {
            clipIcon.classList.add('hidden');
            checkIcon.classList.remove('hidden');
            setTimeout(() => {
              clipIcon.classList.remove('hidden');
              checkIcon.classList.add('hidden');
            }, 1200);
          }
        } catch {
          // Clipboard might be blocked. We fail silently because we're not monsters.
        }
      });
    }
  </script>
</nav>

<style is:global>
  #site-nav.scrolled {
    background-color: rgba(26, 26, 26, 0.9);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
</style>
